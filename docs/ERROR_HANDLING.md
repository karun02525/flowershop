# API Error Response Documentation

## Overview
The Flower Shop API now returns clean, structured error responses for validation failures and other errors.

---

## Validation Error Response Format

When validation fails (e.g., missing required fields or invalid data), the API returns:

### Response Structure
```json
{
  "timestamp": "2026-01-25T10:20:43.225",
  "status": 400,
  "error": "Validation Failed",
  "message": "Please correct the following fields",
  "validationErrors": {
    "firstName": "First name is required",
    "lastName": "Last name is required",
    "address": "Address must be between 10 and 200 characters",
    "gender": "Gender is required",
    "dob": "Date of birth is required"
  }
}
```

### HTTP Status Code
- **400 Bad Request** - For validation failures

---

## User Registration Validation Rules

### Required Fields
All of the following fields are **required**:

| Field | Validation Rule | Error Message |
|-------|----------------|---------------|
| `firstName` | - Not blank<br>- 2-50 characters<br>- Only letters and spaces | First name is required<br>First name must be between 2 and 50 characters<br>First name should contain only letters |
| `lastName` | - Not blank<br>- 2-50 characters<br>- Only letters and spaces | Last name is required<br>Last name must be between 2 and 50 characters<br>Last name should contain only letters |
| `email` | - Not blank<br>- Valid email format<br>- Max 100 characters | Email is required<br>Email should be valid<br>Email must not exceed 100 characters |
| `mobile` | - Not blank<br>- Exactly 10 digits | Mobile number is required<br>Mobile number must be 10 digits |
| `address` | - Not blank<br>- 10-200 characters | Address is required<br>Address must be between 10 and 200 characters |
| `gender` | - Not blank<br>- Must be: Male, Female, or Other | Gender is required<br>Gender must be Male, Female, or Other |
| `dob` | - Not blank<br>- Format: YYYY-MM-DD | Date of birth is required<br>Date of birth must be in format YYYY-MM-DD |

### Auto-Generated Fields
- **`createdAt`** - Automatically set to current timestamp when user is created
- **`id`** - Automatically generated by MongoDB

---

## Example: Valid User Registration Request

### Request
```bash
POST /api/users
Content-Type: application/json
```

```json
{
  "firstName": "Karun",
  "lastName": "Kumar",
  "email": "karunkumar@example.com",
  "mobile": "9876543210",
  "address": "123 Main Street, Pune, Maharashtra",
  "gender": "Male",
  "dob": "1995-05-15"
}
```

### Response (Success)
```json
{
  "id": "65b1c8e9f1234567890abcde",
  "firstName": "Karun",
  "lastName": "Kumar",
  "email": "karunkumar@example.com",
  "mobile": "9876543210",
  "address": "123 Main Street, Pune, Maharashtra",
  "gender": "Male",
  "dob": "1995-05-15",
  "createdAt": "2026-01-25T10:30:00.123"
}
```

**Status Code:** `200 OK`

---

## Example: Invalid User Registration Request

### Request (Missing Required Fields)
```json
{
  "email": "test@example.com",
  "mobile": "1234567890",
  "address": "pune"
}
```

### Response (Validation Error)
```json
{
  "timestamp": "2026-01-25T10:20:43.225",
  "status": 400,
  "error": "Validation Failed",
  "message": "Please correct the following fields",
  "validationErrors": {
    "firstName": "First name is required",
    "lastName": "Last name is required",
    "address": "Address must be between 10 and 200 characters",
    "gender": "Gender is required",
    "dob": "Date of birth is required"
  }
}
```

**Status Code:** `400 Bad Request`

---

## Other Error Types

### Runtime Errors
```json
{
  "timestamp": "2026-01-25T10:20:43.225",
  "status": 500,
  "error": "Internal Server Error",
  "message": "Specific error message"
}
```

**Status Code:** `500 Internal Server Error`

---

## Testing with Bruno/Postman

### Valid Request Example
```json
{
  "firstName": "Rajesh",
  "lastName": "Sharma",
  "email": "rajesh.sharma@example.com",
  "mobile": "9876543210",
  "address": "456 Park Avenue, Mumbai, Maharashtra",
  "gender": "Male",
  "dob": "1990-08-20"
}
```

### Invalid Requests for Testing

#### 1. Missing Required Fields
```json
{
  "email": "test@example.com"
}
```

#### 2. Invalid Email Format
```json
{
  "firstName": "Test",
  "lastName": "User",
  "email": "invalid-email",
  "mobile": "9876543210",
  "address": "123 Test Street, Test City",
  "gender": "Male",
  "dob": "1995-01-01"
}
```

#### 3. Invalid Mobile Number (not 10 digits)
```json
{
  "firstName": "Test",
  "lastName": "User",
  "email": "test@example.com",
  "mobile": "12345",
  "address": "123 Test Street, Test City",
  "gender": "Male",
  "dob": "1995-01-01"
}
```

#### 4. Address Too Short
```json
{
  "firstName": "Test",
  "lastName": "User",
  "email": "test@example.com",
  "mobile": "9876543210",
  "address": "Short",
  "gender": "Male",
  "dob": "1995-01-01"
}
```

#### 5. Invalid Gender Value
```json
{
  "firstName": "Test",
  "lastName": "User",
  "email": "test@example.com",
  "mobile": "9876543210",
  "address": "123 Test Street, Test City",
  "gender": "Unknown",
  "dob": "1995-01-01"
}
```

#### 6. Invalid Date Format
```json
{
  "firstName": "Test",
  "lastName": "User",
  "email": "test@example.com",
  "mobile": "9876543210",
  "address": "123 Test Street, Test City",
  "gender": "Male",
  "dob": "01/01/1995"
}
```

---

## Summary of Changes Made

### 1. **Auto-Generated Timestamp**
   - `createdAt` field is now automatically set when a user is created
   - Uses ISO 8601 format: `YYYY-MM-DDTHH:mm:ss.SSS`

### 2. **Clean Error Responses**
   - Validation errors are now formatted in a user-friendly structure
   - Each field error is listed separately with its specific error message
   - No more long stack traces in the API response

### 3. **Global Exception Handler**
   - Created `GlobalExceptionHandler` class to handle all validation and runtime exceptions
   - Provides consistent error response format across the entire API

---

## Files Modified/Created

1. **Modified:** `User.java` - Added `setCreatedAtNow()` method
2. **Modified:** `UserServiceImpl.java` - Calls `setCreatedAtNow()` before saving user
3. **Created:** `GlobalExceptionHandler.java` - Handles validation and runtime exceptions

---

## Next Steps

To test the changes:

1. **Start MongoDB** (if not already running):
   ```bash
   brew services start mongodb-community
   ```

2. **Build and run the application**:
   ```bash
   ./mvnw clean install
   ./mvnw spring-boot:run
   ```

3. **Test with valid request** using Bruno or Postman:
   - Send POST request to `http://localhost:8080/api/users`
   - Include all required fields
   - Verify `createdAt` is auto-generated

4. **Test with invalid request**:
   - Send POST request with missing fields
   - Verify clean error response is returned
